///////////////////////////////////////////////////////////////////////////
//  Skel.h
///////////////////////////////////////////////////////////////////////////

#ifndef __SKEL_H_INCLUDED__
#define __SKEL_H_INCLUDED__

///////////////////////////////////////////////////////////////////////////
// INCLUDES
///////////////////////////////////////////////////////////////////////////

#include "x_math.hpp"

///////////////////////////////////////////////////////////////////////////
// DEFINES / MACROS
///////////////////////////////////////////////////////////////////////////

#define BONE_DOF_RX     (1<<0)
#define BONE_DOF_RY     (1<<1)
#define BONE_DOF_RZ     (1<<2)
#define BONE_DOF_TX     (1<<3)
#define BONE_DOF_TY     (1<<4)
#define BONE_DOF_TZ     (1<<5)

///////////////////////////////////////////////////////////////////////////
// STRUCTURES
///////////////////////////////////////////////////////////////////////////

typedef struct SSkelBone
{
    char        BoneName[32];
    char        ParentName[32];
    s32         BoneID;
    s32         ParentID;
    s32         MirrorID;
    u32         Flags;
    vector3     OriginToBone;       //  Bone - Origin
    vector3     ParentToBone;       //  Bone - Parent

    // VALUES FROM ASF
    radian3     Axis;               //  ASF axis alignment values
    vector3     BoneVector;         //  Bonelength and direction
    u32         DOFOrder[6];

} t_SkelBone;

class QSkel
{
public:
    ////////////////////////////////////////////////////////////////////////
    // Basic operations
    ////////////////////////////////////////////////////////////////////////
             QSkel( void );
    virtual ~QSkel( void );
    
    void CopySkel       ( QSkel* SkelSrc );

    ////////////////////////////////////////////////////////////////////////
    // Import/export
    ////////////////////////////////////////////////////////////////////////
    xbool       ImportASF       ( const char* FileName );

    ////////////////////////////////////////////////////////////////////////
    // Modifications
    ////////////////////////////////////////////////////////////////////////
    s32         FindBone        ( const char* BoneName );
    const char* GetBoneName     ( s32 BoneID );
    void        DelBone         ( s32 BoneID );
    void        DelDummyBones   ( void );
    void        ClearAxis       ( void );

    ////////////////////////////////////////////////////////////////////////
    // Misc. routines
    ////////////////////////////////////////////////////////////////////////
    void        CalcGlobalPosFromLocal  ( void );
    void        CalcLocalPosFromGlobal  ( void );
    void        DecideMirrorBones       ( void );

    ////////////////////////////////////////////////////////////////////////
    // Data
    ////////////////////////////////////////////////////////////////////////
    s32         m_NBones;
    t_SkelBone* m_pBone;
    f32         m_TransScale;
};

#endif // __SKEL_H_INCLUDED__
